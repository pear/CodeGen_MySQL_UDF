<extension name="gc_dist">
 <deps>
  <header name="math.h"/>
<!--  <lib name="m"/> -->
 </deps>

 <code role="header" position="top">
#define RADIANS(x) ((x) * M_PI / 180.0)
 </code>

 <function name="gc_dist" returns="REAL">
  <param name="radius" type="REAL"/>
  <param name="A_lat"  type="REAL"/>
  <param name="A_lon"  type="REAL"/>
  <param name="B_lat"  type="REAL"/>
  <param name="B_lon"  type="REAL"/>
  <code>
<?data
double x = pow(sin(RADIANS(A_lat - B_lat) / 2), 2) 
         + cos(RADIANS(B_lat)) * cos(RADIANS(A_lat)) * pow(sin(RADIANS(A_lon - B_lon) / 2), 2);

DBUG_RETURN(2 * radius * atan2(sqrt(x), sqrt(1-x)));
?>
  </code>
 </function>
</extension>
